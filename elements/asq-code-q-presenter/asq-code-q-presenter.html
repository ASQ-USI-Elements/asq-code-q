<link rel="import" href="../../../polymer/polymer.html">
<link rel="import" href="../../../ace-element/ace-element.html">
<link rel="import" href="../../../asq-base/asq-base.html">
<link rel="import" href="../../../iron-list/iron-list.html">
<link rel="import" href="../../../iron-flex-layout/iron-flex-layout.html">

<!--
`asq-code-q-presenter` is the __presenter__ version of `asq-code-q`. It's not intended to be used on its own.

@element asq-code-q-presenter
@demo demo/index.html
@group ASQ Elements
@blurb Element used for coding questions.
@homepage http://github.com/ASQ-USI-Elements/asq-code-q
-->
<dom-module id="asq-code-q-presenter">
  <style>
    :host{
      @apply(--layout-vertical);
      min-width:100px;
      min-height: 300px;
    }

    #aceContainer{
      position:relative;
      min-height:150px;
      @apply(--layout-flex);
    }

    #list-container {
      @apply(--layout-vertical);
      @apply(--layout-flex);
      min-height:100px;
    }

    #leList {
      @apply(--layout-flex);
    }

    </style>
  <template>
    <div id="leContent"><content select="asq-stem"></content></div>
    <div id="aceContainer">
      <ace-element id="editor" theme="{{theme}}" mode="{{mode}}" readonly="{{disabled}}" wrap="{{wrap}}" font-size="{{fontSize}}" tabsize="{{tabSize}}">{{value}}</ace-element>
    </div>

    <div id="list-container">
      <iron-list id="leList" items="[[_answers]]" as="answer">
        <template>
          <div class="{{_computeClass(selected)}}">
            #<span>[[index]]</span>, Answer data from user: <span>[[answer.name]]</span>
            <input type="checkbox" checked="[[answer.checked]]">
          </div>
        </template>
      </iron-list>
    </div>


  </template>
</dom-module>
<script>
  (function () {
    Polymer({
      is: 'asq-code-q-presenter',
      
      properties: {

        _answers: {
          type: Array,
          notify: true,
          value: function() { return []; }
        },

        /**
         * Set to true to style the element as disabled.
         * Binded to `readonly` of ace-editor.
         */
        disabled: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        },

        /**
         * The fontSize property of the ace-element.
         */
        fontSize: { 
          type: String,
          value: "12px",
          notify: true,
          reflectToAttribute: true
        },

        /**
         * The mode property of the ace-element.
         */
        mode: {
          type: String,
          value: 'javascript',
          reflectToAttribute: true,
          notify: true
        },

        /**
         * The tabSize property of the ace-element.
         */
        tabSize: { 
          type: Number,
          value: 2,
          notify: true,
          reflectToAttribute: true,
        },

        /**
         * The theme property of the ace-element.
         */
        theme: {
          type: String,
          value: 'monokai',
          notify: true,
          reflectToAttribute: true,
        },

        /**
         * The value property of the ace-element.
         */
        value: {
          type: String,
          value: null,
          notify: true,
          reflectToAttribute: true,
        },

        /**
         * The wrap property of the ace-element.
         */
        wrap: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true,
        }
      },

      ready: function () {
        if (!this.value) {
          var code = Polymer.dom(this).querySelector('code');
          if (code) {
            this.value = code.textContent;
            console.log(code.textContent)
          }
        }

        //somehow the list doesn't get rendered correctly
        setTimeout(function(){
          this.$.leList._render();
        }.bind(this), 10);
        
      },

      _computeClass: function (selected) {
        var classList = 'row list-item';
        if (selected) classList += ' selected';
        return classList;
      }
    });
  }());
</script>