<link rel="import" href="../../../polymer/polymer.html">
<link rel="import" href="../../../ace-element/ace-element.html">
<link rel="import" href="../../../asq-base/asq-base.html">
<link rel="import" href="../../../iron-flex-layout/iron-flex-layout.html">

<!--
`asq-code-q-presenter` is the __viewer__ version of `asq-code-q`. It's not intended to be used on its own.

@element asq-code-q-viewer
@demo demo/index.html
@group ASQ Elements
@blurb Element that used for programming questions.
@homepage http://github.com/ASQ-USI-Elements/asq-code-q
-->
<dom-module id="asq-code-q-viewer">
  <style>
    :host{
      @apply(--layout-vertical);
      @apply(--layout-flex)
      min-width:100px;
      min-height: 300px;
    }

    #aceContainer{
      @apply(--layout-flex)
      position:relative;
    }

    </style>
  <template>
    <div id="leContent"><content select="asq-stem"></content></div>
    <div id="aceContainer" flex="">
      <ace-element id="editor" theme="{{theme}}" mode="{{mode}}" readonly="{{disabled}}" wrap="{{wrap}}" font-size="{{fontSize}}" tab-size="{{tabSize}}">{{value}}</ace-element>
    </div>

  </template>
</dom-module>
<script>
  (function () {
    Polymer({
      is: 'asq-code-q-viewer',
      
      properties: {

        /**
         * Set to true to style the element as disabled.
         * Binded to `readonly` of ace-editor.
         */
        disabled: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        },

        /**
         * The fontSize property of the ace-element.
         */
        fontSize: { 
          type: String,
          value: "12px",
          notify: true,
          reflectToAttribute: true
        },

        /**
         * The mode property of the ace-element.
         */
        mode: {
          type: String,
          value: 'javascript',
          reflectToAttribute: true,
          notify: true
        },

        /**
         * The tabSize property of the ace-element.
         */
        tabSize: { 
          type: Number,
          value: 2,
          notify: true,
          reflectToAttribute: true,
        },

        /**
         * The theme property of the ace-element.
         */
        theme: {
          type: String,
          value: 'monokai',
          notify: true,
          reflectToAttribute: true,
        },

        /**
         * The value property of the ace-element.
         */
        value: {
          type: String,
          value: null,
          notify: true,
          reflectToAttribute: true,
        },

        /**
         * The wrap property of the ace-element.
         */
        wrap: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true,
        }
      },
      /**
       * The `submit` method returns an object that respresents the submission of this question. The object has the following structure:

           {
              questionUid: this.uid,
              timestamp: new Date(),
              submission: []
           }
       * Only enabled when the `role` of the element is <b>viewer</b>.
       *
       * @method submit
       */
      submit: function () {
        var submission = this.$.editor.editor.session.getValue();
        return {
          submission: submission
        };
      },

      ready: function () {
        if (!this.value) {
          var code = Polymer.dom(this).querySelector('code');
          if (code) {
            //this.value = code.textContent;
            //console.log(code.textContent)
          }
        }
      }
    });
  }());
</script>