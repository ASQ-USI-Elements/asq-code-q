<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ace-element/ace-element.html">
<link rel="import" href="../code-mirror/code-mirror.html">
<link rel="import" href="../asq-base/asq-base.html">

<polymer-element name="asq-code" attributes="theme mode value tabSize label">
  <template>
    <style>
    :host{
      min-width:100px;
      min-height: 100px;
      display: -webkit-box;
      display: -moz-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-direction: normal;
      -moz-box-direction: normal;
      -webkit-box-orient: vertical;
      -moz-box-orient: vertical;
      -webkit-flex-direction: column;
      -ms-flex-direction: column;
      flex-direction: column;
      position:relative;
    }

    #aceContainer{
      position:relative;
    }



    </style>
      <div id="leContent"><content select="asq-stem"></content></div>
      <div id="aceContainer" flex>
        <ace-element id="codeEditor" mode="{{mode}}" theme="{{theme}}" fontSize="{{fontSize}}"></ace-element>
      </div>

    

  </template>

  <script>
    (function () {

      var p = {
        isASQQuestionTypeElement: true,
        type: "asq-code",

        mode: 'javascript',
        theme: 'monokai',
        readonly: false,
        wrap: false,

        //This is necessary in case the codeEditor get's reattached to the DOM after `this`
        attached: function(){
          var code = this.querySelector("code");
          if(code){
            this.$.codeEditor.value = code.textContent;
          }
        },

        ready: function(){
          var code = this.querySelector("code");
          if(code){
            this.$.codeEditor.textContent = code.textContent;
          }
        },

        submit: function() {
          if ( this.role !== this.Roles.VIEWER ) {
            return;
          }

          var submission = this.$.codeEditor.editor.session.getValue();

          return {
            questionUid: this.uid,
            timestamp: new Date(),
            submission: submission
          };
        },
      };

      ASQ.asqify(p, true);
      Polymer('asq-code', p);

    })();
    
  </script>
</polymer-element>