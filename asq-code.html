<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ace-element/ace-element.html">
<link rel="import" href="../code-mirror/code-mirror.html">
<link rel="import" href="../asq-base/asq-base.html">

<!--
`asq-code` is a question type where students can answer programming question proposed by professors. It is built above the `ace` editor.

##### Example
    <asq-code mode="java" tabsize="2">
      <asq-stem><h4>Implement a for loop in Java</h4></asq-stem>
      <code>public class C {
        public void m() {
          int i = i + 5 + ((int)5.0) + ((int)5f);
        }
      }
      </code>
    </asq-code>

@element asq-code
@group ASQ Elements
@blurb Element that used for programming questions.
@homepage http://github.com/ASQ_USI/asq-code
-->
<polymer-element name="asq-code" attributes="theme mode value tabSize label">
  <template>
    <style>
    :host{
      min-width:100px;
      min-height: 100px;
      display: -webkit-box;
      display: -moz-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-direction: normal;
      -moz-box-direction: normal;
      -webkit-box-orient: vertical;
      -moz-box-orient: vertical;
      -webkit-flex-direction: column;
      -ms-flex-direction: column;
      flex-direction: column;
      position:relative;
    }

    #aceContainer{
      position:relative;
    }



    </style>
      <div id="leContent"><content select="asq-stem"></content></div>
      <div id="aceContainer" flex>
        <ace-element id="codeEditor" mode="{{mode}}" theme="{{theme}}" fontSize="{{fontSize}}"></ace-element>
      </div>

    

  </template>

  <script>
    (function () {

      var p = {
        isASQQuestionTypeElement: true,

        /**
         * This attribute defines the code mode of the edior.
         *
         * @attribute mode
         * @type string
         * @default 'javascript'
         */
        mode: 'javascript',

        /**
         * This attribute defines the theme of the edior.
         *
         * @attribute theme
         * @type string
         * @default 'monokai'
         */
        theme: 'monokai',

        /**
         * If this is `true`, then the edior is ready-only.
         *
         * @attribute readonly
         * @type boolean
         * @default false
         */
        readonly: false,
        wrap: false,

        //This is necessary in case the codeEditor get's reattached to the DOM after `this`
        attached: function(){
          var code = this.querySelector("code");
          if(code){
            this.$.codeEditor.value = code.textContent;
          }
        },

        ready: function(){
          var code = this.querySelector("code");
          if(code){
            this.$.codeEditor.textContent = code.textContent;
          }
        },

        /**
         * The `submit` method will submit the answer to a wrapped 'asq-exercise' instance. 
         * Only useful when the `role` is `viewer`.
         *
         * @method submit
         */
        submit: function() {
          if ( this.role !== this.Roles.VIEWER ) {
            return;
          }

          var submission = this.$.codeEditor.editor.session.getValue();

          return {
            questionUid: this.uid,
            timestamp: new Date(),
            submission: submission
          };
        },
      };

      ASQ.asqify(p, true);
      Polymer('asq-code', p);

    })();
    
  </script>
</polymer-element>